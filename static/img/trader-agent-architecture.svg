<svg viewBox="0 0 900 640" xmlns="http://www.w3.org/2000/svg" font-family="system-ui, -apple-system, sans-serif">
  <!-- Background -->
  <rect width="900" height="640" fill="#f8fafc" rx="12"/>
  <text x="450" y="36" text-anchor="middle" font-size="18" font-weight="700" fill="#1e293b">Trader World Model Agent — Architecture</text>
  <text x="450" y="56" text-anchor="middle" font-size="12" fill="#64748b">World Model Core · LLM Reasoning · Agent Policy · Reflection Loop</text>

  <defs>
    <marker id="arrowBlue" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#3b82f6"/>
    </marker>
    <marker id="arrowGreen" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#22c55e"/>
    </marker>
    <marker id="arrowAmber" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#f59e0b"/>
    </marker>
    <marker id="arrowPurple" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#a855f7"/>
    </marker>
    <marker id="arrowRed" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#ef4444"/>
    </marker>
  </defs>

  <!-- ── INPUT COLUMN ── -->
  <!-- Market Data box -->
  <rect x="30" y="90" width="150" height="80" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="105" y="124" text-anchor="middle" font-size="12" font-weight="700" fill="#1e40af">Market Data</text>
  <text x="105" y="141" text-anchor="middle" font-size="10" fill="#1e40af">OHLCV · OrderBook</text>
  <text x="105" y="155" text-anchor="middle" font-size="10" fill="#1e40af">Tick Feed · Macro</text>

  <!-- Text Data box -->
  <rect x="30" y="210" width="150" height="80" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="105" y="244" text-anchor="middle" font-size="12" font-weight="700" fill="#92400e">Text Data</text>
  <text x="105" y="261" text-anchor="middle" font-size="10" fill="#92400e">News · Filings</text>
  <text x="105" y="275" text-anchor="middle" font-size="10" fill="#92400e">Macro Releases</text>

  <!-- ── WORLD MODEL COLUMN ── -->
  <!-- World Model Core box -->
  <rect x="240" y="75" width="175" height="110" rx="8" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
  <text x="327" y="100" text-anchor="middle" font-size="13" font-weight="700" fill="#1e40af">World Model Core</text>
  <line x1="250" y1="108" x2="405" y2="108" stroke="#bfdbfe" stroke-width="1"/>
  <text x="327" y="124" text-anchor="middle" font-size="10" fill="#1e40af">Encoder (Transformer)</text>
  <text x="327" y="139" text-anchor="middle" font-size="10" fill="#1e40af">Dynamics (GRU-GMM)</text>
  <text x="327" y="154" text-anchor="middle" font-size="10" fill="#1e40af">Prediction Head</text>
  <text x="327" y="169" text-anchor="middle" font-size="10" font-weight="600" fill="#3b82f6">z_t ∈ ℝ²⁵⁶</text>

  <!-- LLM Reasoning Engine box -->
  <rect x="240" y="210" width="175" height="110" rx="8" fill="#fffbeb" stroke="#f59e0b" stroke-width="2"/>
  <text x="327" y="235" text-anchor="middle" font-size="13" font-weight="700" fill="#92400e">LLM Reasoning</text>
  <line x1="250" y1="243" x2="405" y2="243" stroke="#fde68a" stroke-width="1"/>
  <text x="327" y="259" text-anchor="middle" font-size="10" fill="#92400e">Text Analysis</text>
  <text x="327" y="274" text-anchor="middle" font-size="10" fill="#92400e">Belief Formation</text>
  <text x="327" y="289" text-anchor="middle" font-size="10" fill="#92400e">Schema-constrained JSON</text>
  <text x="327" y="304" text-anchor="middle" font-size="10" font-weight="600" fill="#f59e0b">b_t (belief vector)</text>

  <!-- ── CONDITIONER ── -->
  <rect x="480" y="130" width="155" height="75" rx="8" fill="#f0fdf4" stroke="#22c55e" stroke-width="2"/>
  <text x="557" y="157" text-anchor="middle" font-size="12" font-weight="700" fill="#166534">Belief Conditioner</text>
  <line x1="490" y1="164" x2="625" y2="164" stroke="#bbf7d0" stroke-width="1"/>
  <text x="557" y="179" text-anchor="middle" font-size="10" fill="#166534">z_cond = z_t + α·Δz(b_t)</text>
  <text x="557" y="193" text-anchor="middle" font-size="10" fill="#166534">α = confidence gate</text>

  <!-- ── AGENT POLICY ── -->
  <rect x="480" y="265" width="155" height="90" rx="8" fill="#faf5ff" stroke="#a855f7" stroke-width="2"/>
  <text x="557" y="292" text-anchor="middle" font-size="13" font-weight="700" fill="#6b21a8">Agent Policy</text>
  <line x1="490" y1="299" x2="625" y2="299" stroke="#e9d5ff" stroke-width="1"/>
  <text x="557" y="315" text-anchor="middle" font-size="10" fill="#6b21a8">Actor-Critic (PPO)</text>
  <text x="557" y="329" text-anchor="middle" font-size="10" fill="#6b21a8">π(z_cond, b_t, portfolio)</text>
  <text x="557" y="343" text-anchor="middle" font-size="10" font-weight="600" fill="#a855f7">→ HOLD/BUY/SELL</text>

  <!-- ── TRADE EXECUTION ── -->
  <rect x="700" y="220" width="155" height="75" rx="8" fill="#fff1f2" stroke="#ef4444" stroke-width="2"/>
  <text x="777" y="248" text-anchor="middle" font-size="13" font-weight="700" fill="#991b1b">Trade Decision</text>
  <line x1="710" y1="255" x2="845" y2="255" stroke="#fecaca" stroke-width="1"/>
  <text x="777" y="271" text-anchor="middle" font-size="10" fill="#991b1b">Execute Order</text>
  <text x="777" y="284" text-anchor="middle" font-size="10" fill="#991b1b">Update Portfolio</text>

  <!-- ── REFLECTION LOOP ── -->
  <rect x="480" y="415" width="375" height="80" rx="8" fill="#f0f9ff" stroke="#0284c7" stroke-width="2"/>
  <text x="667" y="442" text-anchor="middle" font-size="13" font-weight="700" fill="#0c4a6e">Reflection Loop</text>
  <line x1="490" y1="449" x2="845" y2="449" stroke="#bae6fd" stroke-width="1"/>
  <text x="667" y="465" text-anchor="middle" font-size="10" fill="#0c4a6e">Post-trade LLM introspection · Lesson extraction</text>
  <text x="667" y="480" text-anchor="middle" font-size="10" fill="#0c4a6e">Persistent agent memory (100 items) · Injected into future prompts</text>

  <!-- ── FORECAST OUTPUT ── -->
  <rect x="700" y="75" width="155" height="110" rx="8" fill="#ecfdf5" stroke="#10b981" stroke-width="2"/>
  <text x="777" y="100" text-anchor="middle" font-size="12" font-weight="700" fill="#065f46">Price Forecasts</text>
  <line x1="710" y1="108" x2="845" y2="108" stroke="#a7f3d0" stroke-width="1"/>
  <text x="777" y="124" text-anchor="middle" font-size="10" fill="#065f46">1-bar direction</text>
  <text x="777" y="139" text-anchor="middle" font-size="10" fill="#065f46">5-bar direction</text>
  <text x="777" y="154" text-anchor="middle" font-size="10" fill="#065f46">20-bar direction</text>
  <text x="777" y="169" text-anchor="middle" font-size="10" fill="#065f46">90% CI · Volatility</text>

  <!-- ── ARROWS ── -->
  <!-- Market Data → World Model Core -->
  <line x1="180" y1="130" x2="238" y2="130" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>

  <!-- Text Data → LLM Reasoning -->
  <line x1="180" y1="250" x2="238" y2="250" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowAmber)"/>

  <!-- World Model Core → Belief Conditioner (z_t) -->
  <line x1="415" y1="150" x2="478" y2="163" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>

  <!-- LLM Reasoning → Belief Conditioner (b_t) -->
  <line x1="415" y1="260" x2="478" y2="185" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowAmber)"/>

  <!-- Belief Conditioner → Agent Policy -->
  <line x1="557" y1="205" x2="557" y2="263" stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreen)"/>

  <!-- Agent Policy → Trade Decision -->
  <line x1="635" y1="310" x2="698" y2="280" stroke="#a855f7" stroke-width="2" marker-end="url(#arrowPurple)"/>

  <!-- Belief Conditioner → Price Forecasts -->
  <line x1="635" y1="155" x2="698" y2="140" stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreen)"/>

  <!-- Trade Decision → Reflection Loop -->
  <line x1="777" y1="295" x2="777" y2="413" stroke="#0284c7" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrowBlue)"/>

  <!-- Agent Policy → Reflection Loop -->
  <line x1="557" y1="355" x2="557" y2="413" stroke="#0284c7" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrowBlue)"/>

  <!-- Reflection Loop → LLM Reasoning (feedback, curved) -->
  <path d="M 480 455 Q 200 540 200 350 Q 200 280 238 265" stroke="#0284c7" stroke-width="2" stroke-dasharray="6,3" fill="none" marker-end="url(#arrowBlue)"/>

  <!-- ── LEGEND ── -->
  <rect x="30" y="540" width="840" height="80" rx="8" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
  <text x="450" y="562" text-anchor="middle" font-size="11" font-weight="700" fill="#475569">Legend</text>
  <line x1="60" y1="578" x2="100" y2="578" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
  <text x="110" y="582" font-size="10" fill="#475569">Quantitative flow</text>
  <line x1="200" y1="578" x2="240" y2="578" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowAmber)"/>
  <text x="250" y="582" font-size="10" fill="#475569">Semantic/text flow</text>
  <line x1="370" y1="578" x2="410" y2="578" stroke="#22c55e" stroke-width="2" marker-end="url(#arrowGreen)"/>
  <text x="420" y="582" font-size="10" fill="#475569">Conditioned state</text>
  <line x1="530" y1="578" x2="570" y2="578" stroke="#a855f7" stroke-width="2" marker-end="url(#arrowPurple)"/>
  <text x="580" y="582" font-size="10" fill="#475569">Policy action</text>
  <line x1="670" y1="578" x2="710" y2="578" stroke="#0284c7" stroke-width="2" stroke-dasharray="6,3" marker-end="url(#arrowBlue)"/>
  <text x="720" y="582" font-size="10" fill="#475569">Reflection feedback</text>

  <text x="60" y="607" font-size="10" fill="#64748b">VMC (Vision-Memory-Controller): World Model Core = Vision + Memory · Agent Policy = Controller · LLM = Semantic Belief Updater · Reflection = Self-improving Memory</text>
</svg>
