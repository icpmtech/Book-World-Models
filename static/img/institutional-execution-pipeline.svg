<svg viewBox="0 0 900 580" xmlns="http://www.w3.org/2000/svg" font-family="system-ui, -apple-system, sans-serif">
  <!-- Background -->
  <rect width="900" height="580" fill="#f8fafc" rx="12"/>
  <text x="450" y="36" text-anchor="middle" font-size="18" font-weight="700" fill="#1e293b">Institutional Execution Pipeline</text>
  <text x="450" y="56" text-anchor="middle" font-size="12" fill="#64748b">TWAP · VWAP · IS · World-Model-Guided Adaptive Execution</text>

  <defs>
    <marker id="aBlue" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#3b82f6"/>
    </marker>
    <marker id="aGreen" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#22c55e"/>
    </marker>
    <marker id="aAmber" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#f59e0b"/>
    </marker>
    <marker id="aRed" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#ef4444"/>
    </marker>
    <marker id="aPurple" markerWidth="8" markerHeight="8" refX="6" refY="3" orient="auto">
      <path d="M0,0 L0,6 L8,3 z" fill="#8b5cf6"/>
    </marker>
  </defs>

  <!-- Step 1: Order Receipt -->
  <rect x="30" y="80" width="180" height="70" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.8"/>
  <text x="120" y="108" text-anchor="middle" font-size="12" font-weight="700" fill="#1d4ed8">1. Order Receipt</text>
  <text x="120" y="126" text-anchor="middle" font-size="10" fill="#1e40af">Portfolio manager intent</text>
  <text x="120" y="141" text-anchor="middle" font-size="10" fill="#1e40af">Size · Urgency · Horizon</text>

  <!-- Arrow right -->
  <line x1="210" y1="115" x2="248" y2="115" stroke="#3b82f6" stroke-width="1.6" marker-end="url(#aBlue)"/>

  <!-- Step 2: Regime Detection -->
  <rect x="250" y="80" width="180" height="70" rx="10" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.8"/>
  <text x="340" y="108" text-anchor="middle" font-size="12" font-weight="700" fill="#5b21b6">2. Regime Detection</text>
  <text x="340" y="126" text-anchor="middle" font-size="10" fill="#6d28d9">World Model z_t</text>
  <text x="340" y="141" text-anchor="middle" font-size="10" fill="#6d28d9">Trend · Vol · Spread regime</text>

  <!-- Arrow right -->
  <line x1="430" y1="115" x2="468" y2="115" stroke="#8b5cf6" stroke-width="1.6" marker-end="url(#aPurple)"/>

  <!-- Step 3: Strategy Selection -->
  <rect x="470" y="80" width="180" height="70" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.8"/>
  <text x="560" y="105" text-anchor="middle" font-size="12" font-weight="700" fill="#92400e">3. Strategy Selection</text>
  <text x="560" y="123" text-anchor="middle" font-size="10" fill="#b45309">TWAP / VWAP / IS</text>
  <text x="560" y="138" text-anchor="middle" font-size="10" fill="#b45309">POV · Adaptive WM</text>

  <!-- Arrow right -->
  <line x1="650" y1="115" x2="688" y2="115" stroke="#f59e0b" stroke-width="1.6" marker-end="url(#aAmber)"/>

  <!-- Step 4: Schedule Optimisation -->
  <rect x="690" y="80" width="180" height="70" rx="10" fill="#dcfce7" stroke="#22c55e" stroke-width="1.8"/>
  <text x="780" y="105" text-anchor="middle" font-size="12" font-weight="700" fill="#15803d">4. Schedule Build</text>
  <text x="780" y="123" text-anchor="middle" font-size="10" fill="#166534">Child order cadence</text>
  <text x="780" y="138" text-anchor="middle" font-size="10" fill="#166534">Slice sizing · Timing</text>

  <!-- Arrow down from Step 4 -->
  <line x1="780" y1="150" x2="780" y2="198" stroke="#22c55e" stroke-width="1.6" marker-end="url(#aGreen)"/>

  <!-- World Model Feedback Loop (central) -->
  <rect x="250" y="200" width="400" height="100" rx="10" fill="#fef9c3" stroke="#ca8a04" stroke-width="2"/>
  <text x="450" y="225" text-anchor="middle" font-size="13" font-weight="700" fill="#92400e">World Model — Execution Monitor</text>
  <text x="450" y="245" text-anchor="middle" font-size="11" fill="#b45309">Real-time market impact model · Shortfall attribution</text>
  <text x="450" y="263" text-anchor="middle" font-size="10" fill="#d97706">Latent state z_t updated every child order fill</text>
  <text x="450" y="281" text-anchor="middle" font-size="10" fill="#d97706">Re-schedules when regime shift detected (&gt; threshold)</text>

  <!-- Arrow down from WM monitor -->
  <line x1="450" y1="300" x2="450" y2="348" stroke="#ca8a04" stroke-width="1.8" marker-end="url(#aAmber)"/>

  <!-- Step 5: Child Order Stream -->
  <rect x="30" y="350" width="840" height="70" rx="10" fill="#f0fdf4" stroke="#22c55e" stroke-width="1.5"/>
  <text x="450" y="375" text-anchor="middle" font-size="13" font-weight="700" fill="#15803d">5. Child Order Execution Stream</text>
  <text x="180" y="398" text-anchor="middle" font-size="10" fill="#166534">Lit Exchange</text>
  <text x="360" y="398" text-anchor="middle" font-size="10" fill="#166534">Dark Pools / ATS</text>
  <text x="540" y="398" text-anchor="middle" font-size="10" fill="#166534">Block Cross</text>
  <text x="720" y="398" text-anchor="middle" font-size="10" fill="#166534">Principal / RFQ</text>

  <!-- Arrow down -->
  <line x1="450" y1="420" x2="450" y2="448" stroke="#22c55e" stroke-width="1.6" marker-end="url(#aGreen)"/>

  <!-- Step 6: TCA and Attribution -->
  <rect x="30" y="450" width="400" height="80" rx="10" fill="#fee2e2" stroke="#ef4444" stroke-width="1.5"/>
  <text x="230" y="476" text-anchor="middle" font-size="12" font-weight="700" fill="#b91c1c">6. TCA &amp; Attribution</text>
  <text x="230" y="496" text-anchor="middle" font-size="11" fill="#991b1b">Implementation shortfall · Slippage · Timing cost</text>
  <text x="230" y="514" text-anchor="middle" font-size="10" fill="#ef4444">Market impact decomposition · Reversion alpha</text>

  <!-- Step 7: Model Update -->
  <rect x="470" y="450" width="400" height="80" rx="10" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.5"/>
  <text x="670" y="476" text-anchor="middle" font-size="12" font-weight="700" fill="#5b21b6">7. World Model Update</text>
  <text x="670" y="496" text-anchor="middle" font-size="11" fill="#6d28d9">Online learning from fill outcomes</text>
  <text x="670" y="514" text-anchor="middle" font-size="10" fill="#8b5cf6">Impact model recalibration · Regime prior update</text>

  <!-- Feedback arrow from TCA back to WM monitor -->
  <path d="M 120 450 Q 120 320 248 300" stroke="#ef4444" stroke-width="1.4" fill="none" stroke-dasharray="5,3" marker-end="url(#aRed)"/>
  <!-- Feedback from WM update to WM monitor -->
  <path d="M 780 450 Q 780 320 652 300" stroke="#8b5cf6" stroke-width="1.4" fill="none" stroke-dasharray="5,3" marker-end="url(#aPurple)"/>

  <!-- WM Feedback loop up to Step 2 -->
  <path d="M 250 250 Q 120 250 120 152" stroke="#8b5cf6" stroke-width="1.4" fill="none" stroke-dasharray="4,3" marker-end="url(#aPurple)"/>
  <text x="85" y="220" text-anchor="middle" font-size="9" fill="#6d28d9" font-style="italic">regime</text>
  <text x="85" y="232" text-anchor="middle" font-size="9" fill="#6d28d9" font-style="italic">feedback</text>
</svg>
